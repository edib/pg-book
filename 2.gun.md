# postgresql dizin yapısı
centos7'de varsayılan kurulumda:
- cluster dosya ve dizinleri ```/var/lib/pgsql/11/data``` altındadır. PostgreSQL terminolojisinde Cluster, çalışan ve veritabanı isteklerini karşılayan servisin ayar dosyaları ve veritabanlarının verilerinin tutulduğu dizinler anlamına gelir.
- çalıştırılabilir dosyalar ```/usr/pgsql-11/bin/``` altındadır.

## data altındaki yeni başlayanlar için önemli dosyalar ve dizinler
- **postgresql.conf:** `Cluster` servisinin başlarken kullandığı ve `Cluster` seviyesinde ayarların yapıldı dosyadır.
- **pg_hba.conf:** `Cluster` için, istemci, veritabanı, kullanıcı ve erişim yöntemi gibi birçok erişim denetimi ayarlarının yapıldığı dosyadır.
- **pg_ident.conf:** `Cluster` kullanıcı ve sistem kullanıcı eşleştirmesinin yapılması gerekiyorsa buradan yapılmaktadır.
- **base:**  Veritabanlarının asıl verisi bulunur.
- **global:** `Cluster` genelindeki tablolar burada bulunur. Örn: pg_database
- **log:** text logları. erişim logları bulunur.
- **pg_tblspc:** Oluşturulan `tablespace`lerin kısa yolları bulunur.
- **pg_wal:** `Transaction log`ların tutulduğu dizin. Olabildiğince uzak durulmalıdır. Asla elle silinmemelidir.


## psql
* psql postgresql instance'a ulaşmak için kullanılan bir komut satırı istemcisidir.

```
--- psql client komutlarının listesi
\?

--- sql komutlarının listesi
\h

--- bir schema altındaki tüm nesnelerin listesi
\d

--- tablolar
\dt

--- gösterimler (views)
\dv

--fonksiyonlar
\df

-- kullanıcılar, roller
\du
-- vb.
```

* PostgreSQL'de veritabanları ve tablolar dosya sisteminde dizinlere ve dosyalara karşılık gelirler. Bunu görebilmek için

```
-- veritabanların dizinleri
select oid, datname from pg_database ;

-- tabloların gerçek dizinleri
select pg_relation_filepath('{TABLO_ADI}');
-[ RECORD 1 ]--------+-----------------
pg_relation_filepath | base/13025/16384

```

## Örnek Veri İşlemleri
#### copy komutuyla `veritabanı` içerisine veri aktarımı.
Bunun Türkiyenin illeri ve ilçeleri veri setini kullanıyoruz. `postgres` kullanıcında komut satırından aşağıdaki dosyaları indiriyoruz.

```
wget https://raw.githubusercontent.com/edib/publicdata/master/ilce.csv
wget https://raw.githubusercontent.com/edib/publicdata/master/il.csv
```
db de 2 tane tablo oluşturuyor ve aşağıdaki şekilde dosyaları içeri aktarıyoruz.
yeni bir `veritabanı` oluşturuyoruz ve bağlanıyoruz.

```
psql -c "CREATE DATABASE ornek"
psql ornek
```
psql komut satırından
```
--il tablosu
create table il (id serial, il_adi varchar);

--ilce tablosu
create table ilce (id serial, il_id int, ilce_adi varchar);

--il tablosunu doldur
\copy il (id_il_adi) from il.csv WITH CSV HEADER

--ilce tablosunu doldur
\copy ilce (il_id, ilce_adi) from ilce.csv WITH CSV HEADER

--verilere bakalım
select il.il_adi, ilce.ilce_adi from il
inner join ilce on
il.id = ilce.il_id;

```

### `tablespace` işlemleri
temp işlemlerini asıl dizinden ayırmak istersek

```
--örnek dizin
create tablespace temp location '/var/lib/pgsql/11/temp';
```
`postgresql.conf` içerisinde

```
# bu satırı
temp_tablespaces = ''

# buna değiştiriyoruz.
temp_tablespaces = 'temp'
```
PostgreSQL'i reload ediyoruz.
```
# root yetkisindeyken
systemctl reload postgresql-11
# ya da
psql -c "select pg_reload_conf()"

```

## performans ve explain
```
explain (analyze, format yaml) {SORGU}
```
sequential scan
index scan
index bitmap scan
[Explain'i anlamak (https://www.dalibo.org/_media/understanding_explain.pdf)

## [foreign data wrapper](foreign_data_wrapper.md)

[Üçüncü Gün](3.gun.md)
